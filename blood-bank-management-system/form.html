<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blood Bank Registration</title>

  <style>
    body {
      font-family: "Poppins", sans-serif;
      margin: 0;
      background: #ffe6e6;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    header {
      background-color: #e60000;
      color: #fff;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 60px;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }

    nav ul {
      list-style: none;
      display: flex;
      gap: 40px;
      margin: 0;
      padding: 0;
    }

    nav ul li a {
      text-decoration: none;
      color: #fff;
      font-weight: 500;
    }

    form {
      background: #fff;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      width: 400px;
      margin-top: 100px;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin: 8px 0 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    .range-container {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    button {
      background: #e60000;
      color: white;
      border: none;
      padding: 10px;
      width: 100%;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 1rem;
    }

    .hidden {
      display: none;
    }
  </style>
</head>

<body>

<header>
  <h1>ðŸ©¸ Blood Bank Management System</h1>
  <nav>
    <ul>
      <li><a href="home.html">Home</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
  </nav>
</header>

<form action="submit_form.php" method="POST">
  <h2>Blood Bank Form</h2>

  <label>I am a:</label>
  <select id="role" name="role" onchange="toggleFormSections()" required>
    <option value="">-- Select Role --</option>
    <option value="donor">Donor</option>
    <option value="receiver">Receiver</option>
    <option value="request">Request Blood</option>
  </select>

  <div id="commonFields">
    <label>Name:</label>
    <input type="text" name="name" required>

    <label>Age:</label>
    <input type="number" name="age" min="1" required>

    <label>Contact:</label>
    <input type="text" name="contact" maxlength="10" pattern="[0-9]{10}" required
           oninput="this.value = this.value.replace(/[^0-9]/g, '')">

    <label>Blood Group:</label>
    <select name="blood_group" required>
      <option value="A+">A+</option>
      <option value="A-">A-</option>
      <option value="B+">B+</option>
      <option value="B-">B-</option>
      <option value="O+">O+</option>
      <option value="O-">O-</option>
      <option value="AB+">AB+</option>
      <option value="AB-">AB-</option>
    </select>

    <!-- City first -->
    <label>City:</label>
    <input type="text" id="cityInput" name="city" required>

    <!-- Hospital Dropdown -->
    <label>Hospital:</label>
    <select name="hospital_id" id="hospitalDropdown" required>
      <option value="">-- Select Hospital --</option>
    </select>
  </div>

  <!-- Donor Fields -->
  <div id="donorFields" class="hidden">
    <label>Total Blood Donated (Units):</label>
    <div class="range-container">
      <input type="range" name="total_donated" id="donatedRange" min="1" max="5" value="1"
             oninput="updateValue('donatedValue', this.value)">
      <span id="donatedValue">1</span>
    </div>
  </div>

  <!-- Receiver Fields -->
  <div id="receiverFields" class="hidden">
    <label>Total Blood Received (Units):</label>
    <div class="range-container">
      <input type="range" name="total_received" id="receivedRange" min="1" max="5" value="1"
             oninput="updateValue('receivedValue', this.value)">
      <span id="receivedValue">1</span>
    </div>
  </div>

  <!-- Request Fields -->
  <div id="requestFields" class="hidden">
    <label>Units Needed:</label>
    <div class="range-container">
      <input type="range" name="units_needed" id="neededRange" min="1" max="5" value="1"
             oninput="updateValue('neededValue', this.value)">
      <span id="neededValue">1</span>
    </div>

    <label>Reason:</label>
    <input type="text" name="reason">
  </div>

  <button type="submit">Submit</button>
</form>

<script>
function toggleFormSections() {
  document.getElementById("donorFields").classList.add("hidden");
  document.getElementById("receiverFields").classList.add("hidden");
  document.getElementById("requestFields").classList.add("hidden");

  const role = document.getElementById("role").value;
  if (role === "donor") document.getElementById("donorFields").classList.remove("hidden");
  if (role === "receiver") document.getElementById("receiverFields").classList.remove("hidden");
  if (role === "request") document.getElementById("requestFields").classList.remove("hidden");
}

function updateValue(id, value) {
  document.getElementById(id).textContent = value;
}
</script>

<!-- Dynamic Hospital Loader -->
<script>
document.getElementById("cityInput").addEventListener("input", function () {
    let city = this.value.trim();

    if (city.length < 2) return;

    fetch("get_hospitals.php?city=" + city)
      .then(response => response.json())
      .then(data => {
          const dropdown = document.getElementById("hospitalDropdown");
          dropdown.innerHTML = "<option value=''>-- Select Hospital --</option>";

          if (data.length === 0) {
              dropdown.innerHTML += "<option>No hospitals found</option>";
              return;
          }

          data.forEach(hospital => {
              dropdown.innerHTML += `<option value="${hospital.id}">${hospital.hospital_name}</option>`;
          });
      })
      .catch(error => console.error("Error loading hospitals:", error));
});
</script>

</body>
</html>
